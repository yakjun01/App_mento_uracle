import { C as CliConfig } from './index.BBihg1b8.js';
import { A as AppConfig } from './AppConfig.BjmXUQ7C.js';
import { A as AppService } from './AppService.Bv5LpPwI.js';
import { s as sdkService, n as npmService } from './SDKService.DqbWTl4i.js';
import './vendor.DEZAgNuY.js';
import 'node:events';
import 'node:child_process';
import 'node:path';
import 'node:fs';
import 'node:process';
import 'util';
import 'os';
import 'stream';
import 'buffer';
import 'events';
import 'fs';
import 'path';
import 'zlib';
import 'tty';
import 'string_decoder';
import 'http';
import 'https';
import 'crypto';
import 'constants';
import 'assert';
import 'child_process';
import 'url';
import 'node:crypto';
import 'node:os';
import 'node:fs/promises';
import 'node:string_decoder';
import 'domain';
import 'node:stream';
import 'http2';
import 'net';
import 'tls';
import './zip.Urfv9crQ.js';

async function run({ sdk }) {
    const cliConfig = CliConfig.getInstance();
    if (sdk) {
        const [libraries, tools] = await Promise.all([sdkService.selectInstalledLibraries(), sdkService.selectInstalledTools()]);
        process.stdout.write(JSON.stringify({ libraries, tools: tools.filter(({ name }) => name === cliConfig.cliName) }));
        return;
    }
    const appConfig = new AppConfig(process.cwd());
    const appService = new AppService(appConfig);
    await appConfig.load();
    const pkgs = npmService.uniqPkg(await appService.loadAppliedPkgs());
    const json = pkgs.reduce((acc, pkg) => {
        if (pkg.name === cliConfig.cliName) {
            acc.tools.push(pkg);
        }
        else {
            acc.libraries.push(pkg);
        }
        return acc;
    }, { tools: [], libraries: [] });
    process.stdout.write(JSON.stringify(json));
}

export { run };
