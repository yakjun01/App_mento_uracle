import * as path from 'path';
import { y as yauzlExports, l as libExports, a as yazlExports } from './vendor.DEZAgNuY.js';

function unzip(zip, dir, rootFolder) {
    return new Promise((resolve, reject) => {
        yauzlExports.open(zip, { lazyEntries: true }, function (err, zipfile) {
            if (err)
                return reject(err);
            zipfile.on('entry', function (entry) {
                if (/\/$/.test(entry.fileName)) {
                    // Directory file names end with '/'.
                    // Note that entires for directories themselves are optional.
                    // An entry's fileName implicitly requires its parent directories to exist.
                    zipfile.readEntry();
                }
                else {
                    // file entry
                    zipfile.openReadStream(entry, async function (err, readStream) {
                        if (err)
                            return reject(err);
                        // window도 unzip시 경로는 /로 구분한다.
                        const names = entry.fileName.split('/');
                        names[0] = rootFolder; // 루트폴더명 변경
                        const filename = names.pop();
                        const dirpath = path.join(dir, ...names);
                        await libExports.ensureDir(dirpath);
                        const ws = libExports.createWriteStream(path.join(dirpath, filename));
                        ws.on('close', function () {
                            zipfile.readEntry();
                        });
                        readStream.pipe(ws);
                    });
                }
            });
            zipfile.on('end', () => {
                resolve();
            });
            zipfile.on('error', (err) => {
                zipfile.close();
                reject(err);
            });
            zipfile.readEntry();
        });
    });
}
function zip(sources, dest) {
    return new Promise((resolve, reject) => {
        const zipFile = new yazlExports.ZipFile();
        sources.forEach(([src, dest]) => {
            zipFile.addFile(src, dest);
        });
        const ws = libExports.createWriteStream(dest);
        zipFile.outputStream.pipe(ws);
        ws.on('error', reject);
        ws.on('close', resolve);
        zipFile.end();
    });
}

export { unzip as u, zip as z };
