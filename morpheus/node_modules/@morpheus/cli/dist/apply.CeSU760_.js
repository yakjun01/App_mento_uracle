import { l as libExports } from './vendor.DEZAgNuY.js';
import 'path';
import 'os';
import 'url';
import { A as AppConfig } from './AppConfig.BjmXUQ7C.js';
import { A as AssetService, a as AndroidService, I as IosService } from './IosService.CFdTbh92.js';
import { l as licenseService } from './LicenseService.DdVA90Pd.js';
import 'node:events';
import 'node:child_process';
import 'node:path';
import 'node:fs';
import 'node:process';
import 'util';
import 'stream';
import 'buffer';
import 'events';
import 'fs';
import 'zlib';
import 'tty';
import 'string_decoder';
import 'http';
import 'https';
import 'crypto';
import 'constants';
import 'assert';
import 'child_process';
import 'node:crypto';
import 'node:os';
import 'node:fs/promises';
import 'node:string_decoder';
import 'domain';
import 'node:stream';
import 'http2';
import 'net';
import 'tls';
import './index.BBihg1b8.js';
import './zip.Urfv9crQ.js';

async function run(appId) {
    const rootDir = process.cwd();
    const appConfig = new AppConfig(rootDir);
    const [license] = await Promise.all([licenseService.getLicenseByAppId(appId), appConfig.load()]);
    const assetsService = new AssetService(appConfig.assetDir);
    const androidService = new AndroidService(appConfig.androidDir);
    const iosService = new IosService(appConfig.iosDir);
    const usedIos = await libExports.pathExists(appConfig.iosDir);
    const tasks = [];
    tasks.push(assetsService.applyAppLicense(license), androidService.applyLicense(license), androidService.applyPackageName(license, appConfig.extendConfig.androidPackageName));
    if (usedIos && appConfig.extendConfig.iosBundleId) {
        tasks.push(iosService.applyLicense(license), iosService.applyBundleId(license, appConfig.extendConfig.projectName, appConfig.extendConfig.iosBundleId));
    }
    await Promise.all(tasks);
    appConfig.config.json = {
        ...appConfig.extendConfig,
        applicationId: license.appId,
        androidPackageName: license.packageName,
    };
    if (usedIos) {
        appConfig.config.json.iosBundleId = license.bundleId;
    }
    await appConfig.config.write();
}

export { run };
